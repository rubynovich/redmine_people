<div class = "box tabular" id="person_data">     

	<script type="text/javascript">

      function checkWorkPhone(item, item_correct) {
		var error_message =  "<%= l(:field_people_phone_correct) %>";
		var has_error = "";
		var end_str = '';
		var val = document.getElementById(item).value;
		if (val.length < 3) {

		   has_error = error_message; 
		   val = '+7 '; 
		 } 
		 else if (val.length == 3){ // '+7 '
		 	if ( /\+7\s?/.test(val) ){
		 		val = '+7 (';
		 		has_error = '';
		 	}
		 }
		 else if ( (val.length > 4) && (val.length < 8) ){ // '+7 (XXX'
		 	if ( /^\+7\s?\([0-9]{1,3}$/.test(val) ) 
		 		has_error = '';		 	
		 	else 
		 		has_error = error_message;
		 	
		 }
		 else
		    has_error = '' ;

		 if (val.length == 8){  // "+7 (XXX)"
		 	if ( /^\+7\s?\([0-9]{3}[0-9]{1}$/.test(val) ) {
		 		has_error = '';		 	
		 		end_str = val.substr(-1);
		 		val = val.substr(0, val.length -1) + ")" + end_str;
		 	}
		 	else if ( /^\+7\s?\([0-9]{3}[^\)\s]$/.test(val) )
		 		has_error = error_message;
		 	else if ( /^\+7\s?\([0-9]{3}[\s{1}\)]$/.test(val) ){
		 		has_error = '';
		 		val = val.substr(0, val.length -1) + ")";
		 	}

		 }
		 if (val.length == 9){  // "+7 (XXX) "
		 	if ( /^\+7\s?\([0-9]{3}\)[0-9]{1}$/.test(val) ) {
		 		has_error = '';		 	
		 		end_str = val.substr(-1);
		 		val = val.substr(0, val.length -1) + " " + end_str;
		 	}
		 	else if ( /^\+7\s?\([0-9]{3}\)[^\s]$/.test(val) )
		 		has_error = error_message; 	

		 }

		 if ((val.length > 9) && (val.length < 13)){  // '+7 (XXX) XXX'
		 	if ( /^\+7\s?\([0-9]{3}\)\s?[0-9]{1,3}$/.test(val) ) 
		 		has_error = '';		 	
		 	else 
		 		has_error = error_message;
		 }
		 if (val.length == 13){  // '+7 (XXX) XXX-'
		 	if ( /^\+7\s?\([0-9]{3}\)\s?[0-9]{3}[0-9]{1}$/.test(val) ) {
		 		has_error = '';		 	
		 		end_str = val.substr(-1);
		 		val = val.substr(0, val.length -1) + "-" + end_str;
		 	}
		 	else if ( /^\+7\s?\([0-9]{3}\)\s?[0-9]{3}[^\-\s]$/.test(val) )
		 		has_error = error_message;
		 	else if ( /^\+7\s?\([0-9]{3}\)\s?[0-9]{3}\s{1}$/.test(val) ){
		 		has_error = '';
		 		val = val.substr(0, val.length -1) + "-";
		 	}
		 }

		 if ((val.length > 13) && (val.length < 16)){  // '+7 (XXX) XXX-XX'
		 	if ( /^\+7\s?\([0-9]{3}\)\s?[0-9]{3}\-[0-9]{1,2}$/.test(val) ) 
		 		has_error = '';		 	
		 	else 
		 		has_error = error_message;
		 }
		 if (val.length == 16){  // '+7 (XXX) XXX-XX-'
			if ( /^\+7\s?\([0-9]{3}\)\s?[0-9]{3}\-[0-9]{2}[0-9]{1}$/.test(val) ) {
		 		has_error = '';		 	
		 		end_str = val.substr(-1);
		 		val = val.substr(0, val.length -1) + "-" + end_str;
		 	}
		 	else if ( /^\+7\s?\([0-9]{3}\)\s?[0-9]{3}\-[0-9]{2}[^\-\s]$/.test(val) )
		 		has_error = error_message;
		 	else if( /^\+7\s?\([0-9]{3}\)\s?[0-9]{3}\-[0-9]{2}\s{1}$/.test(val) ){
		 		has_error = '';
		 		val = val.substr(0, val.length -1) + "-";
		 	}
		 }
		 if ((val.length > 16) && (val.length <= 18)){	// '+7 (XXX) XXX-XX-XX'
		 	if ( /^\+7\s?\([0-9]{3}\)\s?[0-9]{3}\-[0-9]{2}\-[0-9]{1,2}$/.test(val) ) 
		 		has_error = '';		 	
		 	else 
		 		has_error = error_message;
		 }
		 if (val.length > 18)
		 	has_error = error_message;

 		 document.getElementById(item).value = val;
 		 document.getElementById(item_correct).innerHTML = has_error;
		 checkAll(); 
		}

    </script>

	<p class="avatar" id="watchers">
		<%= avatar(@person, :size => "64", :height => 64, :width => 64, :style => "vertical-align: middle;") %>
		<%= link_to image_tag('delete.png'), {:controller => 'attachments', :action => 'destroy', :id => @person.avatar},
	                                         :confirm => l(:text_are_you_sure),
	                                         :method => :delete,
	                                         :class => 'delete',
											 :style => "vertical-align: middle;",
	                                         :title => l(:button_delete) unless @person.avatar.blank? %>
	</p>    
	<p><%= label_tag l(:field_people_avatar) %> <%= file_field_tag 'person_avatar[file]', :size => 30, :id => nil  -%> </p>
	<p><%= f.text_field :firstname, :required => true %></p>    
	<p><%= f.text_field :middlename, :label => l(:field_people_middlename) %></p>
	<p><%= f.text_field :lastname, :required => true %></p>
	<% if @person.id != User.current.id %>
	<p><%= f.select :status, options_for_select([[l(:status_active), '1'], [l(:status_locked), '3']], @person.status.to_s) %></p>
	<% end %>

	<% unless @departments.blank? %>
		<p><%= f.select :department_id, department_tree_options_for_select(@departments,  :selected => @person.department), :include_blank => true, :label => l(:field_people_department) %></p>	
	<% end %>
	<p><%= f.select :gender, Person::GENDERS, :label => l(:field_people_gender)%></p>
	<p><%= f.select :city, city_options_for_select, :label => l(:field_people_city)%></p>
	<p><%= f.text_field :appearance_date, :size => 12, :label => l(:field_people_appearance_date) %><%= calendar_for('person_appearance_date') %> </p>   
	<p><%= f.text_field :birthday, :size => 12, :label => l(:field_people_birthday) %><%= calendar_for('person_birthday') %> </p>   
	<p><%= f.text_field :job_title, :label => l(:field_people_job_title) %></p>
	<p><%= f.text_field :mail, :required => true %></p>
	<p><%= f.text_area :address, :label=>l(:field_people_address), :rows => 5 -%></p>

	
	<p><label><%= l(:field_people_phone)  -%></label><%= text_field_tag :phone_work, @person.phone_work, :size => 26, :title => "+7 (XXX) XXX-XX-XX", :onkeypress => "checkWorkPhone('phone_work', 'phone_work_correct')", :onfocus => "checkWorkPhone('phone_work', 'phone_work_correct')", :onkeyup => "checkWorkPhone('phone_work', 'phone_work_correct')"-%></p>
	<em id="phone_work_correct" value = ""></em> 
	<p><label><%= l(:field_people_phone_extension)  -%></label><%= text_field_tag :phone_extension, @person.phone_extension, :size => 6  -%></p>
	<p><label><%= l(:field_people_phone_mobile)  -%></label><%= text_field_tag :phone_mobile, @person.phone_mobile, :size => 60, :title => "+7 (XXX) XXX-XX-XX", :onkeypress => "checkWorkPhone('phone_mobile', 'phone_mobile_correct')", :onfocus => "checkWorkPhone('phone_mobile', 'phone_mobile_correct')", :onkeyup => "checkWorkPhone('phone_mobile', 'phone_mobile_correct')" -%></p>  
	<em id="phone_mobile_correct" value = ""></em> 
	 
			
 	<p><%= f.text_field :skype, :label => l(:field_people_skype) -%></p> 
 	<p><%= f.text_field :facebook, :label => l(:field_people_facebook) + ' ID'-%></p> 
 	<p><%= f.text_field :twitter, :label => l(:field_people_twitter) -%></p> 
 	<p><%= f.text_field :linkedin, :label => l(:field_people_linkedin) + ' ID' -%></p> 

	<p class  = "notes"><%= f.text_area :background , :cols => 80, :rows => 8, :class => 'wiki-edit', :label => l(:field_people_background)  %></p>
	<%= wikitoolbar_for 'person_background' %>
	

 
</div>    




